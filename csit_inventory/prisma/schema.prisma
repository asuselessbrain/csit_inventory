// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         String     @id @default(uuid())
  email      String     @unique
  password   String
  role       UserRole   @default(STUDENT)
  userStatus UserStatus @default(ACTIVE)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  admins     Admin?
  student    Student?
  teachers   Teacher?

  @@map("users")
}

model Student {
  id                 String             @id @default(uuid())
  name               String
  phoneNumber        String
  address            String
  studentId          String             @unique
  registrationNumber String             @unique
  profilePhoto       String?
  dateOfBirth        DateTime
  session            String
  schoolName         String
  collageName        String
  status             UserStatus         @default(ACTIVE)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  email              String             @unique
  isDeleted          Boolean            @default(false)
  isApproved         Boolean            @default(false)
  projectAndTheses   ProjectAndThesis[]
  user               User               @relation(fields: [email], references: [email])

  @@map("students")
}

model Admin {
  id          String   @id @default(uuid())
  email       String   @unique
  name        String
  phoneNumber String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  photoUrl    String?
  isDeleted   Boolean  @default(false)
  user        User     @relation(fields: [email], references: [email])

  @@map("admins")
}

model Teacher {
  id               String             @id @default(uuid())
  email            String             @unique
  name             String
  phoneNumber      String
  address          String
  faculty          String
  department       Department
  designation      TeacherDesignation @default(LECTURER)
  isChairman       Boolean            @default(false)
  joinedAt         DateTime
  status           TeacherStatus      @default(ACTIVE)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  photoUrl         String?
  isDeleted        Boolean            @default(false)
  projectAndTheses ProjectAndThesis[]
  user             User               @relation(fields: [email], references: [email])

  @@map("teachers")
}

model ProjectAndThesis {
  id                         String                      @id @default(uuid())
  title                      String
  description                String
  type                       ProjectAndThesisType
  status                     ProjectAndThesisStatus      @default(PENDING)
  studentId                  String
  supervisorId               String
  semester                   Semester
  cratedAt                   DateTime                    @default(now())
  updatedAt                  DateTime                    @updatedAt
  student                    Student                     @relation(fields: [studentId], references: [id])
  supervisor                 Teacher                     @relation(fields: [supervisorId], references: [id])
  projectAndThesisUpdateLogs ProjectAndThesisUpdateLog[]
  tasks                      Task[]

  @@map("project_and_theses")
}

model Task {
  id                         String                      @id @default(uuid())
  title                      String
  description                String
  projectAndThesisId         String
  status                     TaskStatus                  @default(TODO)
  dueDate                    DateTime
  notes                      String?
  createdAt                  DateTime                    @default(now())
  updatedAt                  DateTime                    @updatedAt
  projectAndThesisUpdateLogs ProjectAndThesisUpdateLog[]
  projectAndThesis           ProjectAndThesis            @relation(fields: [projectAndThesisId], references: [id])

  @@map("tasks")
}

model ProjectAndThesisUpdateLog {
  id                 String           @id @default(uuid())
  projectAndThesisId String
  name               String
  updateDescription  String
  taskId             String
  fileUrl            String
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  projectAndThesis   ProjectAndThesis @relation(fields: [projectAndThesisId], references: [id])
  task               Task             @relation(fields: [taskId], references: [id])

  @@map("project_update_logs")
}

enum UserRole {
  ADMIN
  TEACHER
  STUDENT
}

enum UserStatus {
  ACTIVE
  BLOCKED
  DELETED
}

enum StudentStatus {
  ACTIVE
  INACTIVE
  GRADUATED
}

enum TeacherStatus {
  ACTIVE
  STUDY_LEAVE
  RETIRED
}

enum TeacherDesignation {
  LECTURER
  ASSISTANT_PROFESSOR
  ASSOCIATE_PROFESSOR
  PROFESSOR
}

enum Department {
  Computer_Science_And_Information_Technology
  Computer_science_And_Communication_Engineering
  Electrical_And_Electronic_Engineering
  Physics_And_Mechanical_Engineering
  Mathematics
}

enum ProjectAndThesisType {
  PROJECT
  THESIS
}

enum ProjectAndThesisStatus {
  PENDING
  APPROVED
  REJECTED
  in_PROGRESS
  COMPLETED
}

enum Semester {
  FIRST   @map("1st")
  SECOND  @map("2nd")
  THIRD   @map("3rd")
  FOURTH  @map("4th")
  FIFTH   @map("5th")
  SIXTH   @map("6th")
  SEVENTH @map("7th")
  EIGHTH  @map("8th")
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  REVIEW
  DONE
  FAILED
}